<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×¢××™×ª×•×•×•×• ğŸ‰ | 22</title>
  <meta name="description" content="×”×¤×ª×¢×ª ×™×•× ×”×•×œ×“×ª ×œ×¢××™×ª â€” ×•×™×“××•, ×˜×™×™××œ×™×™×Ÿ ×¢× ×ª××•× ×•×ª, ××—×•×œ×œ ××—×××•×ª, ×œ×•×— ×’×™×¨×•×“ ××ª× ×•×ª, ×•×”×‘×¨×›×” ×¢× ××¤×§×˜×™× ×¢×œ ×’×œ×™×œ×”" />
  <meta property="og:title" content="×¢××™×ª×•×•×•×• ğŸ‰ | 22" />
  <meta property="og:description" content="×”×¤×ª×¢×ª ×™×•× ×”×•×œ×“×ª ×œ×¢××™×ª â€” ×•×™×“××•, ×˜×™×™××œ×™×™×Ÿ ×¢× ×ª××•× ×•×ª, ××—×•×œ×œ ××—×××•×ª, ×œ×•×— ×’×™×¨×•×“ ××ª× ×•×ª, ×•×”×‘×¨×›×” ×¢× ××¤×§×˜×™× ×¢×œ ×’×œ×™×œ×”" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630'%3E%3Crect width='100%25' height='100%25' fill='%23ffd9e6'/%3E%3Ctext x='50%25' y='52%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='72' fill='%23ff4d88'%3E×¢××™×ª×•×•×•×• 22%3C/text%3E%3C/svg%3E" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js" defer></script>
  <style>
    :root{ --pink:#ff6fa3; --pink-2:#ffd5e5; --pink-3:#ffc1d6; --rose:#ff2f75; --bg:#fff7fb; --ink:#2a2a2a; --card:#ffffff; --muted:#7a7a7a; --shadow:0 10px 30px rgba(255,111,163,.15) }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Heebo,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--rose)} img{max-width:100%}
    .btn{background:var(--pink);color:#fff;border:0;border-radius:14px;padding:12px 18px;font-weight:700;cursor:pointer;box-shadow:var(--shadow);transition:transform .08s ease}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0)}
    .btn.ghost{background:#fff;color:var(--pink);border:2px solid var(--pink)}
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--pink-2),#fff);z-index:9999}
    .gate .card{width:min(520px,92vw);background:#fff;border-radius:20px;box-shadow:var(--shadow);padding:28px}
    .gate h1{margin:0 0 6px;font-size:28px;color:var(--rose)}
    .gate p{margin:0 0 14px;color:var(--muted)}
    .gate .row{display:flex;gap:10px;margin-top:10px}
    .input{flex:1;border:2px solid var(--pink-3);border-radius:12px;padding:12px 14px;font-size:16px}
    .error{color:#c30052;margin-top:10px;display:none}
    .countdown{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff,var(--pink-2));z-index:8888;text-align:center;padding:20px}
    .countdown h2{color:var(--rose);font-size:26px;margin:0 0 12px}
    .clock{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    .time-box{background:#fff;border-radius:14px;box-shadow:var(--shadow);padding:14px 16px;min-width:82px}
    .time-box .num{font-size:28px;font-weight:900;color:var(--pink)}
    .time-box .lbl{font-size:12px;color:var(--muted)}
    .hint{margin-top:14px;color:var(--muted);font-size:14px}
    .decor{position:fixed;inset:0;pointer-events:none;opacity:.25;z-index:0}
    .blob{position:absolute;filter:blur(50px);opacity:.4}
    .b1{width:340px;height:340px;background:var(--pink-3);top:-60px;right:-40px;border-radius:50%}
    .b2{width:280px;height:280px;background:#ffe5ee;bottom:-40px;left:-60px;border-radius:50%}
    .app{position:relative;z-index:1;display:none}
    header{min-height:92vh;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:18px;text-align:center}
    .title{font-size:48px;line-height:1.05;margin:0 0 12px;color:var(--rose);letter-spacing:1px}
    .subtitle{margin:0;color:#444;font-weight:700}
    .meta{margin-top:10px;color:var(--muted)}
    .actions{display:flex;gap:10px;margin-top:18px;justify-content:center}
    section{padding:36px 18px}
    .sec{max-width:880px;margin:0 auto}
    .card{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:22px}
    .grid{display:grid;gap:16px}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    @media(max-width:780px){.grid.cols-2{grid-template-columns:1fr}}
    .h{margin:0 0 12px;color:var(--pink);font-size:22px}
    .p{white-space:pre-line;line-height:1.8;font-size:18px}
    .timeline{display:flex;gap:12px;overflow:auto;padding:6px 2px;scroll-snap-type:x proximity}
    .chip{flex:0 0 auto;display:inline-flex;align-items:center;gap:8px;background:#fff;border:2px solid var(--pink-3);color:#333;padding:10px 14px;border-radius:999px;font-weight:700;box-shadow:var(--shadow);cursor:pointer;scroll-snap-align:center}
    .video-card video{width:100%;max-height:70vh;border-radius:12px;background:#000;display:block}
    .audio-card audio{width:100%}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:9000}
    .lightbox.show{display:flex}
    .lb-content{display:flex;flex-direction:column;gap:6px;background:#fff;border-radius:16px;box-shadow:var(--shadow);max-width:min(920px,96vw);max-height:90vh;width:100%;overflow:hidden}
    .lb-img-wrap{flex:1 1 auto;display:flex;align-items:center;justify-content:center;background:#000}
    .lb-content img{max-width:100%;max-height:80vh;object-fit:contain;background:#000;display:block}
    .lb-cap{padding:10px 12px;font-weight:700;color:#444;text-align:center}
    .lb-close{position:fixed;top:16px;left:16px;background:var(--pink);color:#fff;border:0;border-radius:999px;width:42px;height:42px;font-size:18px;cursor:pointer;box-shadow:var(--shadow)}
    .hearts{position:fixed;inset:0;pointer-events:none;z-index:7777}
    .heart{position:absolute;font-size:18px;animation:floatUp 2.4s ease-in forwards}
    @keyframes floatUp{from{transform:translateY(0) scale(.9);opacity:.95} to{transform:translateY(-120vh) scale(1.3);opacity:0}}
    /* ×œ×•×— ×’×™×¨×•×“ */
    .scratch-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;user-select:none;-webkit-user-select:none}
    @media(min-width:880px){.scratch-grid{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .scratch-card{position:relative;background:#fff;border-radius:16px;box-shadow:var(--shadow);overflow:hidden;min-height:128px}
    @media(min-width:880px){.scratch-card{min-height:150px}}
    .scratch-content{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;padding:16px}
    .scratch-content .title{font-weight:900;font-size:clamp(14px,3.6vw,18px);color:var(--rose);line-height:1.25;word-break:break-word}
    .scratch-content .sub{font-weight:700;font-size:clamp(12px,3.2vw,15px);color:#666;margin-top:6px;line-height:1.3;word-break:break-word}
    .scratch-canvas{position:absolute;inset:0;touch-action:none;background:transparent}
    .scratch-card.revealed .scratch-canvas{display:none}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    @media (prefers-reduced-motion: reduce){ *{scroll-behavior:auto} }
  </style>
</head>
<body>
  <!-- ×¢×™×˜×•×¨×™× -->
  <div class="decor" aria-hidden="true"><div class="blob b1"></div><div class="blob b2"></div></div>

  <!-- ×©×¢×¨ ×¡×™×¡××” -->
  <div id="gate" class="gate">
    <div class="card">
      <h1>ğŸ”’ ×”×™×™! ×™×© ×›××Ÿ ×”×¤×ª×¢×” ×©××•×¨×” ×œ×¢××™×ª</h1>
      <p>×”×›× ×™×¡×™ ×¡×™×¡××” ×›×“×™ ×œ×”×™×›× ×¡ ğŸ’—</p>
      <div class="row">
        <input id="pw" class="input" type="password" placeholder="×¡×™×¡××”" autocomplete="current-password" aria-label="×¡×™×¡××”" />
        <button class="btn" id="enterBtn" type="button">×›× ×™×¡×”</button>
      </div>
      <div id="err" class="error">×¡×™×¡××” ×©×’×•×™×”. × ×¡×™ ×©×•×‘ ğŸ™‚</div>
      <p class="hint" id="previewHint" style="display:none">××¦×‘ ×ª×¦×•×’×” ××•×§×“××ª ×¤×¢×™×œ.</p>
    </div>
  </div>

  <!-- ×¡×¤×™×¨×” ×œ××—×•×¨ -->
  <div id="countdown" class="countdown">
    <div>
      <h2>ğŸ‚ ×–×” ×›××¢×˜ ×›××Ÿ! ×”×”×¤×ª×¢×” × ×¤×ª×—×ª ×‘Ö¾20/10/2025</h2>
      <div class="clock" id="clock"></div>
      <div class="hint">× ×›× ×¡×™× ×¢× ×”×¡×™×¡××”, ×•××– ×”×”×¤×ª×¢×” ×ª×¤×ª×— ×‘×ª××¨×™×š â€” ×¢×“ ××– ××•×ª×¨ ×¨×§ ×œ×”×¦×™×¥ ×‘×©×¢×•×Ÿ ğŸ˜‰</div>
    </div>
  </div>

  <!-- ×”××¤×œ×™×§×¦×™×” -->
  <main id="app" class="app" aria-live="polite">
    <header class="sec">
      <h1 class="title" id="bigTitle">×¢××™×ª×•×•×•×•</h1>
      <p class="subtitle">×—×•×’×’×ª 22 Â· 20/10/2003</p>
      <p class="meta">××•×›× ×” ×œ×”×¤×ª×¢×”? ×œ×—×¦×™ğŸ‘‡</p>
      <div class="actions">
        <button class="btn" id="reveal" type="button">×¤×ª×—×™ ××ª ×”×”×¤×ª×¢×” ğŸ</button>
        <button class="btn ghost" id="playSong" type="button">× ×’×Ÿ ××ª ×”×©×™×¨ ğŸµ</button>
      </div>
    </header>

    <!-- ×•×™×“××• -->
    <section class="sec">
      <div class="card video-card">
        <h3 class="h">ğŸ¥ ×¡×¨×˜×•×Ÿ ×‘×¨×›×”</h3>
        <video id="greetVideo" controls playsinline webkit-playsinline preload="metadata" src="assets/greeting.mp4"></video>
        <p class="hint">×œ×—×¦×™ ×¤×œ×™×™ ×›×“×™ ×œ×¦×¤×•×ª (×× ×›×™, ××ª××™× ×œ××™×™×¤×•×Ÿ).</p>
      </div>
    </section>

    <!-- ××•×–×™×§×” -->
    <section class="sec">
      <div class="card audio-card">
        <h3 class="h">ğŸ¶ ×”×©×™×¨ ×©×œ× ×•: Pop Danthology 2012</h3>
        <audio id="song" preload="none" controls src="assets/pop-danthology-2012.mp3">×”×“×¤×“×¤×Ÿ ×©×œ×š ××™× ×• ×ª×•××š ×‘× ×’×Ÿ ××•×“×™×•.</audio>
        <p class="hint">×‘Ö¾iPhone ×¦×¨×™×š ×œ×’×¢×ª ×‘×›×¤×ª×•×¨ × ×™×’×•×Ÿ ×›×“×™ ×œ×”×ª×—×™×œ.</p>
      </div>
    </section>

    <!-- ×˜×™×™××œ×™×™×Ÿ (×”×›×¤×ª×•×¨×™× ×©×œ×š ×›××• ×§×•×“×) -->
    <section class="sec">
      <div class="card">
        <h3 class="h">ğŸŒŸ ×¨×’×¢×™× ×•××§×•××•×ª ×©×œ× ×•</h3>
        <p class="hint">×œ×—×¦×™ ×¢×œ ×¨×’×¢ ×›×“×™ ×œ×¤×ª×•×— ×ª××•× ×”; ×ª×™××•×¨ ×™×•×¤×™×¢ ×œ××˜×”.</p>
        <div class="timeline" id="timeline">
          <button class="chip" type="button" data-photo="assets/places/weed.jpg" data-cap="×¡×˜×œ× ×™× ××Ÿ ×”×× ×™×™×Ÿ">×¡×˜×œ× ×™×ª ×”××•×¢×“×¤×ª ×¢×œ×™â¤ï¸</button>
          <button class="chip" type="button" data-photo="assets/places/eilat.jpg" data-cap="××™×œ×ª â€” ×—×•×¤×©×” ××˜×•×¨×¤×ª">ğŸï¸ ××™×œ×ª</button>
          <button class="chip" type="button" data-photo="assets/places/deadsea.jpg" data-cap="×™× ×”××œ×— â€” ×¨××™× ×• ×–×¨×™×—×”ğŸŒ…">ğŸ§‚ ×™× ×”××œ×—</button>
          <button class="chip" type="button" data-photo="assets/places/video.jpg" data-cap="××ª ×”×›×™ ××ª×•×§×”!">×©×™×—×•×ª ×•×™×“××•</button>
          <button class="chip" type="button" data-photo="assets/places/video2.jpg" data-cap="××ª ×¢×“×™×™×Ÿ ××ª×•×§×”!">×•×¢×•×“ ×©×™×—×•×ª ×•×™×“××•</button>
          <button class="chip" type="button" data-photo="assets/places/65.jpg" data-cap="×©×©-×‘×© ×›×™ ×–×” ×—×œ×§ ××”××•×¤×™ ×©×œ× ×•">×©×©-×‘×©</button>
          <button class="chip" type="button" data-photo="assets/places/beach.jpg" data-cap="×”×™× â€” ×”××§×•× ×©×œ×™××“×ª ××•×ª×™ ×œ××”×•×‘ ××—×“×©">ğŸ–ï¸ ×”×™×</button>
          <button class="chip" type="button" data-photo="assets/places/beach_65.jpg" data-cap="×©×™×œ×•×‘ ×× ×¦×—">ğŸ–ï¸ ×©×©-×‘×© ×•×™×</button>
          <button class="chip" type="button" data-photo="assets/places/happy.jpg" data-cap="×©××—×ª×™ ×œ×”×™×•×ª ××™×ª×š ×‘×¨×’×¢ ×”×©××— ×”×–×”!">×¨×’×¢×™× ×©××—×™×: ×”×™×•× ×©×”×¤×›×ª ×œ× ×”×’×ª</button>
          <button class="chip" type="button" data-photo="assets/places/sad.jpg" data-cap="×©××—×ª×™ ×œ×”×™×•×ª ×œ×¦×™×“×š ×’× ×‘×¨×’×¢×™× ×§×©×™×">×•×¨×’×¢×™× ×¤×—×•×ª ×©××—×™×...</button>
          <button class="chip" type="button" data-photo="assets/places/omer-adam.jpg" data-cap="Omer AdamğŸ˜">ğŸ¤ ×”×•×¤×¢×” ×©×œ ×¢×•××¨ ××“×</button>
          <button class="chip" type="button" data-photo="assets/places/shoval.jpg" data-cap="×©×•×‘×œ×™ ××××™"> ×©×•×‘×œ×™ ×•× ×”×•×¨××™</button>
          <button class="chip" type="button" data-photo="assets/places/taqueria-tlv.jpg" data-cap="×”××¡×¢×“×” ×©×œ× ×•: ×˜××§×¨×™×” ğŸŒ¯">ğŸŒ® ×˜××§×¨×™×” ×ª×œÖ¾××‘×™×‘</button>
          <button class="chip" type="button" data-photo="assets/places/hiro.jpg" data-cap="×›× ××¤×” ×¢× ×”×™×¨×• ×¡××ŸğŸŒ">×›× ××¤×” ×¡××ŸğŸŒ</button>
          <button class="chip" type="button" data-photo="assets/places/food.jpg" data-cap="×œ×¨×’×¢ ×œ× ×”×¤×¡×§× ×• ×œ××›×•×œ!">×¢×•×“ ××•×›×œ</button>
          <button class="chip" type="button" data-photo="assets/places/hafgana.jpg" data-cap="××¤×™×œ×• ×œ×”×¤×’× ×•×ª ×”×¦×œ×—×ª ×œ×§×—×ª ××•×ª×™!">××¤×’×™× ×™× ×•× ×”× ×™×</button>
          <button class="chip" type="button" data-photo="assets/places/hami.jpg" data-cap="×¤×’×©× ×• ×¤×™×™××•×¡ ×‘×”×¤×’× ×”!">××¤×’×™× ×™× ×¢× ×—××™!</button>
          <button class="chip" type="button" data-photo="assets/places/shoping.jpg" data-cap="×©×•×¤×™× ×’ ×›×™ ×× ×—× ×• ××•×”×‘×™× ×œ×‘×–×‘×– ×›×¡×£">×§×•× ×™× ×•× ×”× ×™×ğŸ›’</button>
          <button class="chip" type="button" data-photo="assets/places/stanley.jpg" data-cap="××™ ×”×™×” ××××™×Ÿ ×©××¤×•×œ ×’× ×œ×–×”?">×¡×˜× ×œ×™ ×§××¤</button>
          <button class="chip" type="button" data-photo="assets/places/monika.jpg" data-cap="×ª×•×“×” ×¢×œ ×ª×•×¡×¤×ª × ×—××“×” ×œ××•×¤×™">ğŸ¸ ×”×•×¤×¢×ª ××•× ×™×§×” ×¡×§×¡</button>
          <button class="chip" type="button" data-photo="assets/places/tzafon.jpg" data-cap="ğŸï¸×”×¦×¤×•×Ÿ ×©×œ× ×•!">×”×œ×™×œ×” ×‘×¦×¤×•×ŸğŸï¸</button>
          <button class="chip" type="button" data-photo="assets/places/osher.jpg" data-cap="× ×–×›×¨×™× ×‘×¢×™× ×™×™×”">ğŸ¶ ×”×•×¤×¢×ª ××•×©×¨ ×›×”×Ÿ</button>
          <button class="chip" type="button" data-photo="assets/places/yasmin.jpg" data-cap="×¤×¡×˜×™×‘×œ ×”×ª××¨ - ×™×¡××™×Ÿ ××•×¢×œ×">ğŸ¶ ×¤×¡×˜×™×‘×œ ×”×ª××¨ - ×™×¡××™×Ÿ ××•×¢×œ×</button>
          <button class="chip" type="button" data-photo="assets/places/omer-tamar.jpg" data-cap="×¤×¡×˜×™×‘×œ ×”×ª××¨ - ×¢×•××¨ ××“×">ğŸ¶ ×¤×¡×˜×™×‘×œ ×”×ª××¨ - ×¢×•××¨</button>
          <button class="chip" type="button" data-photo="assets/places/haild.jpg" data-cap="×¤×¡×˜×™×‘×œ ×”×ª××¨ - ××™×¤×” ×”×™×œ×“">ğŸ¶ ×¤×¡×˜×™×‘×œ ×”×ª××¨ - ××™×¤×” ×”×™×œ×“</button>
          <button class="chip" type="button" data-photo="assets/places/mosh.jpg" data-cap="×¤×¡×˜×™×‘×œ ×”×ª××¨ - ××•×©, ××‘×¨×”× ×•×›×œ ×”×©××¨">ğŸ¶ ×¤×¡×˜×™×‘×œ ×”×ª××¨ - ××•×©, ××‘×¨×”× ×•×›×œ ×”×©××¨</button>
        </div>
      </div>
    </section>

    <!-- ××—×•×œ×œ ××—×××•×ª -->
    <section class="sec">
      <div class="card">
        <h3 class="h">ğŸ’¬ ××—×•×œ×œ ××—×××•×ª ×œ×¢××™×ª</h3>
        <div class="compliment" id="compliment">×œ×—×¦×™ ×¢×œ ×”×›×¤×ª×•×¨â€¦</div>
        <div class="actions" style="margin-top:12px">
          <button class="btn" id="nextCompliment" type="button">×ª× ×™ ×œ×™ ××—×××” ğŸ</button>
        </div>
      </div>
    </section>

    <!-- ×”×‘×¨×›×” -->
    <section class="sec">
      <div class="grid cols-2" id="blessingGrid"></div>
    </section>

    <!-- ×œ×•×— ×’×™×¨×•×“ -->
    <section class="sec">
      <div class="card">
        <h3 class="h">ğŸª„ ×œ×•×— ×’×™×¨×•×“ ×”××ª× ×•×ª</h3>
        <p class="hint">×’×¨×“×™ ××ª ×”××©×‘×¦×•×ª ×›×“×™ ×œ×—×©×•×£ ×”×¤×ª×¢×•×ª. ××¤×©×¨ ×œ×’×¨×“ ××ª ×›×•×œ×Ÿ! ğŸ©·</p>
        <div id="scratchGrid" class="scratch-grid" aria-live="polite"></div>
        <div class="actions" style="margin-top:12px">
          <button class="btn ghost" id="resetScratch" type="button">××™×¤×•×¡ ×”×œ×•×—</button>
        </div>
      </div>
    </section>

    <!-- ×¤×•×˜×¨ -->
    <section class="sec" style="padding-bottom:80px">
      <div class="card" style="text-align:center">
        <p class="hint">× ×‘× ×” ×‘××”×‘×”. ×¦×‘×¢×™×: ×•×¨×•×“/×œ×‘×Ÿ ×‘×œ×‘×“. ××™×Ÿ ×¡×’×•×œ ğŸ™…â€â™€ï¸</p>
      </div>
    </section>

    <!-- ×œ×‘×‘×•×ª + ×œ×™×™×˜×‘×•×§×¡ -->
    <div id="hearts" class="hearts" aria-hidden="true"></div>
    <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="×ª××•× ×” ××”××™×¨×•×¢">
      <button class="lb-close" id="lbClose" aria-label="×¡×’×™×¨×”" type="button">âœ•</button>
      <div class="lb-content">
        <div class="lb-img-wrap"><img id="lbImg" alt="×ª××•× ×”" loading="lazy" decoding="async" /></div>
        <div id="lbCap" class="lb-cap"></div>
      </div>
    </div>
  </main>

  <script>
  (()=> {
    const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
    const qs = (s,el=document)=> el.querySelector(s);
    const qsa = (s,el=document)=> [...el.querySelectorAll(s)];
    const prefersReducedMotion = matchMedia('(prefers-reduced-motion: reduce)').matches;

    /* ===== Gate ===== */
    const PASSWORD_HASH = "4a46b0304f5d192b82dfe73eeebbbe2c0ac569338a14c09e17643ad14709b3cd";
    const BDAY_ISO = "2025-10-20T00:00:00+03:00";
    const $gate=qs('#gate'), $err=qs('#err'), $countdown=qs('#countdown'), $clock=qs('#clock'), $app=qs('#app');
    const $song=qs('#song'), $playSong=qs('#playSong'), $reveal=qs('#reveal'), $hearts=qs('#hearts'), $previewHint=qs('#previewHint');
    const url = new URL(location.href);
    const isPreview = url.searchParams.get('preview') === '1';
    if(isPreview){ $previewHint.style.display='block'; }

    async function sha256Hex(str){
      try{ const enc=new TextEncoder(); const buf=await crypto.subtle.digest('SHA-256',enc.encode(str));
        return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }catch{ return null; }
    }
    async function checkPassword(pw){ const hex=await sha256Hex(pw); return hex? hex===PASSWORD_HASH : pw==='amito22'; }

    async function handleEnter(){
      const pw=qs('#pw').value||''; const ok=await checkPassword(pw);
      if(!ok){ $err.style.display='block'; return; }
      $err.style.display='none';
      const now=new Date(), target=new Date(BDAY_ISO);
      if(now<target && !isPreview){ $gate.style.display='none'; $countdown.style.display='flex'; startCountdown(target); }
      else { $gate.style.display='none'; startApp(); }
    }
    qs('#enterBtn').addEventListener('click', handleEnter);
    qs('#pw').addEventListener('keydown', e=>{ if(e.key==='Enter') handleEnter(); });

    function startCountdown(target){
      function tick(){
        const now=new Date(); let diff=Math.max(0,target-now);
        const sec=Math.floor(diff/1000)%60, min=Math.floor(diff/1000/60)%60, hr=Math.floor(diff/1000/60/60)%24, day=Math.floor(diff/1000/60/60/24);
        $clock.innerHTML=`
          <div class="time-box"><div class="num">${day}</div><div class="lbl">×™××™×</div></div>
          <div class="time-box"><div class="num">${hr.toString().padStart(2,'0')}</div><div class="lbl">×©×¢×•×ª</div></div>
          <div class="time-box"><div class="num">${min.toString().padStart(2,'0')}</div><div class="lbl">×“×§×•×ª</div></div>
          <div class="time-box"><div class="num">${sec.toString().padStart(2,'0')}</div><div class="lbl">×©× ×™×•×ª</div></div>`;
        if(diff<=0) location.reload();
      }
      tick(); setInterval(tick,1000);
    }

    /* ===== App ===== */
    function startApp(){
      $app.style.display='block';
      if(window.gsap && !prefersReducedMotion){
        if(window.ScrollTrigger) gsap.registerPlugin(ScrollTrigger);
        gsap.from('#bigTitle',{y:20,opacity:0,duration:.8,ease:'power2.out'});
      }
      setupBlessing();
      setupTimelineLightbox();
      setupScratch();
    }

    $reveal.addEventListener('click', async ()=>{ heartConfetti(); await sleep(120); window.scrollTo({top:window.innerHeight,behavior:'smooth'}); });
    $playSong.addEventListener('click', ()=>{ $song.play().catch(()=>{}) });

    /* ××—×•×œ×œ ××—×××•×ª */
    const compliments = ["××ª ×”×›×™ ×¨×–×”","×”×›×™ ×™×¤×” ×‘×¢×•×œ×","×œ×‘ ×©×œ ×–×”×‘","×”×›×™ ××¦×—×™×§×” ×‘×—×“×¨","×—×›××” ×‘×˜×™×¨×•×£","×¢×•×¦××” ×©×§×˜×” ×©× ×•×›×—×ª","×”×—×™×‘×•×§ ×©×œ×š ××ª×§×Ÿ ×™××™× ×§×©×™×","×—×™×•×š ×©××¨×™× ××¦×‘ ×¨×•×— ×‘×©× ×™×™×”","××œ×›×ª ×”×•×™×™×‘ ×”×˜×•×‘","××œ×•×¤×ª ×”'×™×”×™×” ×˜×•×‘ â€” ×‘×•××™ × ×–×™×– ××ª ×–×”'","××™× ×˜×•××™×¦×™×” ×©×œ ×’××•×Ÿ","×”×›×™ ×××™×ª×™×ª ×©×™×©","×§×©×•×‘×” ×›××• ×¤×¡×™×›×•×œ×•×’×™×ª, ×–×•×¨××ª ×›××• ×—×‘×¨×” ×”×›×™ ×˜×•×‘×”","×¡×˜×™×™×œ ×©×œ ××™×œ×™×•×Ÿ ×“×•×œ×¨ ×‘×œ×™ ×œ×”×©×ª×“×œ","×¢×•×©×” ×× ×©×™× ×¡×‘×™×‘×š ×™×•×ª×¨ ×˜×•×‘×™×","×”×•××•×¨ ×©××’×¨×© ×¢× × ×™×","×¡×•×¤×¨-×›×™×©×¨×•× ×™×ª, × ×§×•×“×”","×× ×”×œ×ª ×›××•×¡ ×›××• ×‘×•×¡","×œ×‘ ×©×œ ×¦'×™×¤×¡ ×—× â€” ×××›×¨","×”-GOAT ×©×œ ×”×—×‘×¨×•×ª","×”-MVP ×©×œ ×”×©× ×” ×©×œ×™","×”×›×™ '××¤×©×¨ ×œ×¡××•×š ×¢×œ×™×”' ×©×× ×™ ××›×™×¨","××ª ×”×•×¤×›×ª ×–×™×›×¨×•× ×•×ª ×œ×¡×¨×˜","×”×¤×ª×¢×•×ª ×§×˜× ×•×ª â€” ×¨×’×¢×™× ×’×“×•×œ×™×","××•××¥ ×©× ×“×‘×§","×”××‘×˜ ×©×œ×š ××•××¨ '×¡××•×š ×¢×œ×™×™' â€” ×•×ª××™×“ ×¢×•×‘×“","××ª ×¢×•×©×” ×˜×•×‘ ×œ×¢×•×œ× ×‘×œ×™ ×œ×¢×©×•×ª ××–×” ×¢× ×™×™×Ÿ","××—×ª ×•×™×—×™×“×” â€” ×¢××™×ª ××•×—×™×•×Ÿ ğŸ’¥"];
    qs('#nextCompliment').addEventListener('click', ()=>{
      const t=compliments[Math.floor(Math.random()*compliments.length)];
      const el=qs('#compliment'); el.textContent=t;
      if(window.gsap && !prefersReducedMotion) gsap.fromTo(el,{scale:.92,opacity:.7},{scale:1,opacity:1,duration:.2});
    });

    /* ×œ×‘×‘×•×ª */
    function heartConfetti(){
      if(prefersReducedMotion) return;
      const EMO=['ğŸ’—','ğŸ’“','ğŸ’–','ğŸ’','ğŸ’•','ğŸ’˜'];
      for(let i=0;i<24;i++){ const s=document.createElement('span'); s.className='heart'; s.textContent=EMO[Math.floor(Math.random()*EMO.length)];
        s.style.left=(Math.random()*100)+'vw'; s.style.bottom='-20px'; s.style.animationDelay=(Math.random()*0.3)+'s';
        $hearts.appendChild(s); setTimeout(()=>s.remove(),2700);
      }
    }

    /* ×œ×™×™×˜×‘×•×§×¡ */
    const $lightbox=qs('#lightbox'), $lbImg=qs('#lbImg'), $lbCap=qs('#lbCap'), $lbClose=qs('#lbClose');
    function openLightbox(src, cap){
      if(!src) return; $lbCap.textContent = cap || '';
      const base = src.split('/').pop() || ''; const stem = base.replace(/\.(jpe?g|webp|png)$/i,'');
      const exts = ['.jpg','.jpeg','.webp','.png']; const withPath = p => p.startsWith('assets/places/') ? p : 'assets/places/'+p;
      const candidates = [src, withPath(base), ...exts.map(e => withPath(stem+e))];
      let i=0; $lbImg.onerror=()=>{ i++; if(i<candidates.length){ $lbImg.src=candidates[i]; } else { $lbImg.removeAttribute('src'); $lbCap.textContent=(cap? cap+' â€” ' : '')+'×ª××•× ×” ×ª×¢×œ×” ×‘×”××©×š'; } };
      $lbImg.src=candidates[0]; $lightbox.classList.add('show'); $lightbox.style.display='flex';
    }
    function closeLightbox(){ $lightbox.classList.remove('show'); $lightbox.style.display='none'; $lbImg.removeAttribute('src'); }
    $lbClose.addEventListener('click', closeLightbox);
    $lightbox.addEventListener('click', e=>{ if(e.target===$lightbox) closeLightbox() });
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLightbox() });
    function setupTimelineLightbox(){
      qsa('#timeline .chip').forEach(btn=>{
        if(!btn.type) btn.type='button';
        btn.addEventListener('click', ()=> openLightbox(btn.dataset.photo, btn.dataset.cap || btn.textContent.trim()));
        btn.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); btn.click(); }});
      });
    }

    /* ×”×‘×¨×›×” */
    const blessingText = `×¢××™×ª×•×•×• ×©×œ×™×™×™×™×™ ×™×© ×œ×š ×”×™×•× ×™×•× ×”×•×œ×“×ª ×•××•×× × ××ª ×©×•× ××ª ××ª ×”×™×•× ×”×–×” ××‘×œ ×‘×©×‘×™×œ×™ ×–××ª ×”×–×“×× ×•×ª ×œ×”×’×™×“ ×œ×š ×ª×•×“×” ×•×œ×”×¨××•×ª ×œ×š ×›××” ××ª ×‘×Ÿ ××“× ××“×”×™×!!
×§×•×“× ×›×œ ××œ× ××œ× ××–×œ ×˜×•×‘×‘×‘×‘×‘!!â¤â¤

××– ×¢××™×ª×™,
×× ×™ ×¨×•×¦×” ×œ××—×œ ×œ×š ×‘×××ª ××ª ×›×œ ×”×˜×•×‘ ×©×”×¢×•×œ× ×™×›×•×œ ×œ×”×¦×™×¢ ×œ×š.
××ª ×”××™×©×” ×”×›×™ ××™×•×—×“×ª, ××“×”×™××”, ××•×”×‘×ª, ××›×¤×ª×™×ª, ××ª×—×©×‘×ª, ××¦×—×™×§×”, ×™×¤×”, ×—×–×§×”, ×—×›××” ×•××›×™×œ×” ×©×§×™×™××ª ×‘×¢×•×œ× ×”×–×”!
××” ×•×›××¢×˜ ×©×›×—×ª×™, ××ª ×”×›×™ ×›×©×¨×•× ×™×ª ×‘×¢×•×œ×!!!
×œ× ×‘×¨×•×¨ ××™×š ×‘×Ÿ ××“× ×¢× ×›×œ ×›×š ×”×¨×‘×” ×ª×›×•× ×•×ª ×‘××•×¤×™ ×©×œ×• ×™×›×•×œ ×œ×—×©×•×‘ ×©××™×Ÿ ×œ×• ××•×¤×™ğŸ¤·â€â™‚ğŸ¤¦â€â™‚
××ª ×¤×©×•×˜ ×”×›×™ ×˜×•×‘×” ×¢××™×ª!!!!!

××ª ×—×‘×¨×” ××“×”×™××”, ×™×•×“×¢×ª ×œ×”×§×©×™×‘ ×›×©×¦×¨×™×š, ×™×•×“×¢×ª ×œ×”×¦×—×™×§ ×›×©×¦×¨×™×š, ×™×•×“×¢×ª ×œ×ª×ª ×‘×¨××© ×•×œ× ×¢×¨ ×›×©×¦×¨×™×š ×•×ª××™×“ ××‘×œ ×ª××™×“ ×¤×” ×‘×©×‘×™×œ×™ ×œ×›×œ ×“×‘×¨!
××ª ×”×‘×Ÿ ××“× ×©×× ×™ ×¤×•×¨×§ ×œ×• ×›×©×¨×¢ ×œ×™, ×”×‘×Ÿ ××“× ×©×× ×™ ×¨×¥ ×œ×¡×¤×¨ ×œ×• ×›×©×§×•×¨×” ×œ×™ ××©×”×• ×˜×•×‘, ××ª ×‘×××ª ×›××• ×”×¤×¡×™×›×•×œ×•×’×™×ª ×”××™×©×™×ª ×©×œ×™!!
××ª ×™×•×“×¢×ª ×œ×¡×“×¨ ×œ×™ ×”×¨××© ×‘×¨×’×¢ ×¢× ×”××™×œ×™× ×©×œ×š ×•×¢×¦× ×”× ×•×›×—×•×ª ×©×œ×š ××¨×’×™×¢×”.
×›×œ ××—×“ ×¦×¨×™×š ×¢××™×ª×™ ×‘×—×™×™× ×©×œ×• ×©×ª×¡×“×¨ ×œ×• ××ª ×”××•×—.

××•×× × ×× ×—× ×• ××›×™×¨×™× ×¨×§ ×©× ×” ××‘×œ ×–××ª ×‘×”×—×œ×˜ ×”×™×™×ª×” ×©× ×” ××œ××” ×‘×—×•×•×™×•×ª ××˜×•×¨×¤×•×ª ×‘×§×©×¨ ×©×œ× ×•.
×× ×™ ××•×“×” ×¢×œ×™×™×š ×›×œ ×™×•× ×©× ×›× ×¡×ª ×œ×—×™×™× ×©×œ×™ ×•×œ×™××“×ª ××•×ª×™ ××—×“×© ××ª ×”×¢×¨×š ×©×œ ×”××™×œ×” ×´×—×‘×¨×•×ª×´.

××ª ×’×¨××ª ×œ×™ ×œ×”×™×¤×ª×— ××—×“×© ×•×œ×”×›× ×™×¡ ××•×ª×š ×œ×—×™×™× ×©×œ×™,  ××—×¨×™ ×ª×§×•×¤×” ××¨×•×›×” ×©×œ× ×”×¦×œ×—×ª×™ ×œ×™×™×¦×¨ ×§×©×¨×™× ×—×“×©×™×, ×‘×’×œ×œ ×›××” ×× ×©×™× ×©×§×¨××ª×™ ×œ×”× ×—×‘×¨×™× ×©×œ×™ ×•×‘×××ª ×©×‘×¨×• ×œ×™ ××ª ×”×œ×‘.
×”×¨××ª ×œ×™ ×‘×××ª ××™×–×” ×× ×©×™× ×× ×™ ×¨×•×¦×” ×©×™×”×™×• ×¡×‘×™×‘×™ ×•××” ××’×™×¢ ×œ×™ ×‘×××ª, ×”×¨××ª ×œ×™ ×©××’×™×¢ ×œ×™ ×× ×©×™× ×›××•×š!!!( ×•×”×œ×•×•××™ ×•×”×™×” ×™×•×ª×¨ )

×× ×™ ×××—×œ ×œ×š ×©×¨×§ ×ª××©×™×›×™ ×œ×”×ª×¤×ª×—, ×œ×—×•×•×ª ×•×œ×’×“×•×œ.
×× ×™ ××›×™×¨ ××•×ª×š ×©× ×” ×•×‘×©× ×” ×”×–××ª ×¨××™×ª×™ ××•×ª×š ×¤×•×¨×—×ª ×•××ª×’×‘×¨×ª ×¢×œ ×”×¤×—×“×™× ×©×œ×š, ×©×•×‘×¨×ª ×’×‘×•×œ×•×ª ×•×× ×™ ×”×›×™ ×’××” ×‘×š ×‘×¢×•×œ×!!
××ª ×”×¨×‘×” ×¤×¢××™× ×—×•×©×‘×ª ×©××ª ×¤×—×•×ª ××× ×©×™× ××—×¨×™× ×•××•×¨×™×“×” ×œ×¢×¦××š ×•×–×” ×¤××§×™× ×’ ×œ× × ×›×•×Ÿ!! ××– ×ª×¤×¡×™×§×™ ×¢× ×–×”!! ××ª ×¢××™×ª ××•×—×™×•×Ÿ, ××ª ×”×‘×Ÿ ××“× ×”×›×™ ××•×©×œ× ×©×§×™×™× ×‘×¢×•×œ× ×”×–×” ×•××™ ×©××•××¨ ××—×¨×ª ×× ×•×ª×§â€¦
×× ×™ ×™×•×“×¢ ×©×¢×‘×¨×ª ×›×œ ×›×š ×”×¨×‘×” ×‘×—×™×™× ×•××ª ×¤××§×™× ×’ ×’×™×‘×•×¨×” ××˜×•×¨×¤×ª ×©××—×¨×™ ×›×œ ×–×” ××ª ×§××” ×‘×‘×•×§×¨ ××—×™×™×›×ª ×•×©××” ×–×™×Ÿ ×¢×œ ×”×¢×•×œ× ×•×¢×“×™×™×Ÿ ×¢× ×›×œ ×–×” ××ª ×¤×©×•×˜ ×”×‘×Ÿ ××“× ×”×›×™ ×˜×•×‘ ×©×× ×™ ××›×™×¨!
×× ×–×” ×œ×—×™×™×š ×œ×©×•××¨ ×‘×—× ×™×•×Ÿ ××• ×œ××•×›×¨ ×‘××›×•×œ×ª,
×œ×“××•×’ ×œ×›×œ ×”×—×‘×¨×™× ×©×œ×š, ×œ×©×§×¨ ×©×‘××œ×š ×œ×¢×©×•×ª ×“×‘×¨×™× ×¨×§ ×›×™ ××™×©×”×• ××—×¨ ×¨×•×¦×” ×œ×¢×©×•×ª ××ª ×–×”, ××• ×¡×ª× ×œ×”×™×•×ª ×—××•×“×” ×œ×× ×©×™× ×¨× ×“×•××œ×™×™×.
×× ×™ ×™×›×•×œ ×œ×”××©×™×š ×¤×” ×œ× ×¦×— ×œ×”×’×™×“ ×›××” ×˜×•×‘×” ×•××“×”×™××” ×•×× ×™ ××§×•×•×” ×•×‘×˜×•×— ×©×œ××˜ ×œ××˜ ×ª×‘×™× ×™ ×‘×¢×¦××š ×›××” ××ª ××˜×•×¨×¤×ª ×•××“×”×™××”, ×›×™ ××™×Ÿ ×˜×•×‘×™× ×›××•×š ×•×××š!


×× ×™ ×™×•×“×¢ ×©×× ×™ ×™×›×•×œ ×œ×¡××•×š ×¢×œ×™×™×š ×‘×”×›×œ! ××ª ×”×‘×Ÿ ××“× ×©×™×•×“×¢ ×¢×œ×™ ×”×›×™ ×”×¨×‘×” ×“×‘×¨×™×, ××ª ×”×©×¨×™×˜×•×ª ×”×›×™ ×¢××•×§×•×ª ×©×œ×™ ×•×’× ××ª ×”×“×‘×¨×™× ×”×›×™ ×˜×•×‘×™×.
××ª ×‘×™×Ÿ ×”×× ×©×™× ×”×™×—×™×“×™× ×‘×¢×•×œ× ×”×–×” ×©× ×•×ª× ×™× ×œ×™ ×œ×”×¨×’×™×© ×©×× ×™ ×™×›×•×œ ×œ×”×™×•×ª ×× ×™ ×”×××™×ª×™, ×‘×œ×™ ×©×•× ××¡×›×” ×•×‘×œ×™ ×©×•× ×¤×•×–×”. ×¤×©×•×˜ ×× ×™!

×× ×—× ×• ××›×™×¨×™× ×›×‘×¨ ×©× ×”  ×•×›×›×œ ×©×¢×•×‘×¨ ×”×–××Ÿ ×× ×™ ××‘×™×Ÿ ×©×× ×—× ×• ×ª×§×•×¢×™× ××—×“ ×¢× ×”×©× ×™×™×” ×œ×ª××™×“!!
×•×©×©×•× ×¨×™×‘ ××• ×•×•×™×›×•×— ×œ× ×™×¦×œ×™×— ×œ×”×¨×•×¡ ××ª ×”×—×‘×¨×•×ª ×©×™×© ×‘× ×™× ×•, ×›×™ ×”×§×©×¨ ×©×œ× ×• ×”×•× ×¤×©×•×˜ ×—×‘×¨×•×ª ×××ª ×•×œ×›×œ ×”×—×™×™×!!

×× ×™ ×‘×ª×§×•×¤×” ×”××—×¨×•× ×” ×¢×‘×¨×ª×™ ×”×¨×‘×” ×©×™× ×•×™×™× ×‘×—×™×™× ×©×œ×™, ×•×–××ª ×”×™×™×ª×” ×ª×§×•×¤×” ×××•×“ ××¡×•×‘×›×ª ×‘×©×‘×™×œ×™ ×©×œ× × ×©××¨×ª×™ ×¢× ×”×¨×‘×” ×× ×©×™× ×‘×—×™×™× ×©×œ×™, ×•××ª ×¤×©×•×˜ ×ª××™×“ ×”×™×™×ª ×¤×” ×‘×©×‘×™×œ×™ ×›×©×”×™×™×ª×™ ×¦×¨×™×š.

×•×¢×›×©×™×• ×§×¦×ª ×ª×•×“×•×ª ×›×™ ××’×™×¢ ×œ×š!

××– ×ª×•×“×” ×¢××™×ª×™â¤
×§×•×“× ×›×œ ×ª×•×“×” ×©×¡××›×ª ×¢×œ×™ ××œ×›×ª×—×™×œ×” ×›×™ ×–×” ×œ× ××•×‘×Ÿ ×××œ×™×• ×©×ª×¡××›×™ ×›×›×” ×¢×œ ×’×‘×¨,
×ª×•×“×” ×©× ×¤×ª×—×ª ×‘×¤× ×™ ×•×¡×™×¤×¨×ª ×œ×™ ×¢×œ ×¢×¦××š,
×ª×•×“×” ×¢×œ ×©×”×™×™×ª ×©× ×œ×¢×–×•×¨ ×œ×™ ×›×©×”×™×™×ª×™ ×¦×¨×™×š, 
×ª×•×“×” ×©×”×¦×—×§×ª ××•×ª×™ ×›×©×”×™×™×ª×™ ×¢×¦×•×‘, 
×ª×•×“×” ×©×™×“×¢×ª ×œ×”×™×•×ª ×›×¨×¦×™× ×™×ª ×©×¦×¨×™×š, 
×ª×•×“×” ×©×”×™×™×ª ×œ×™×“×™ ×‘×¨×’×¢×™× ×”×§×©×™×,
×ª×•×“×” ×©×¡×‘×œ×ª ××•×ª×™ ×›×©×”×™×™×ª×™ ×‘×™×œ×ª×™ × ×¡×‘×œ ( ×™×•×“×¢ ×©×× ×™ ×™×›×•×œ ×œ×”×™×•×ª ×›×–×” ×”×¨×‘×” ×¤×¢××™× ),
×ª×•×“×” ×¢×œ ××™×š ×¤×’×©×ª×™ ××ª ××× ×•×¢×•×“ ××œ× ×¡×“×¨×•×ª,
×ª×•×“×” ×¢×œ ×˜×¢× × ×”×“×¨ ×‘×©×™×¨×™×,
×ª×•×“×” ×©×œ×™××“×ª ××•×ª×™ ×œ××”×•×‘ ××ª ×”×™×,
×ª×•×“×” ×¢×œ ×”××•×¤×™ ×©×¢×–×¨×ª ×œ×™ ×œ×‘× ×•×ª,
×ª×•×“×” ×©×§×™×“××ª ××•×ª×™ ×‘×›×œ ×›×š ×”×¨×‘×” ×“×‘×¨×™×,
×•×¨×©×™××ª ×”×ª×•×“×•×ª ×œ× ×ª×™×’××¨ ×‘×—×™×™× ×›× ×¨××”, ××– ×¤×©×•×˜ ×ª×•×“×”! ×ª×•×“×” ×¢×œ ×”×›×œ!!
×•×œ×ª×•×“×” ×”××—×¨×•× ×”, ×¢××™×ª ×‘×××ª ×¤×©×•×˜ ×ª×•×“×” ×¢×œ ××™ ×•××” ×©××ª ×‘×©×‘×™×œ×™!!!! â¤â¤
×•××œ ×ª×©×ª× ×™ ×‘×—×™×™×, ×›×™ ××ª ××•×©×œ××ª ×›××• ×©××ª!!!

××–×›×™×¨ ×œ×š ×©×× ×™ ×¤×” ×ª××™×“ ×‘×©×‘×™×œ×š ×œ×›×œ ×“×‘×¨ ×•×‘×›×œ ×–××Ÿ ×©××ª ×¦×¨×™×›×”!!!
×•×”×“×‘×¨ ×”××—×¨×•×Ÿ ×•×”×›×™ ×—×©×•×‘ ×œ×™, ×× ×™ ×××—×œ ×œ×©× ×™× ×• ×œ×©××•×¨ ×¢×œ ××•×ª×• ×§×©×¨ ×§×¨×•×‘ ×›×–×” ×•×‘×—×™×™× ×œ× ×œ×¨×™×‘, ××‘×œ ×‘×××ª ×‘×—×™×™×!

 ××•×”×‘ ××•×ª×š ×”×›×™ ×”×¨×‘×” ×‘×¢×•×œ× ×¢××™×ª×™!!â¤â€ğŸ”¥ğŸ˜ğŸ˜˜`;

    function setupBlessing(){
      const container = qs('#blessingGrid');
      const parts = blessingText.split(/\n\s*\n/).filter(Boolean);
      const effectsCycle = ['type','cascade','flip','timeline','reveal','highlight','sparkle','mask','stamp','checklist','finale'];
      container.innerHTML = '';
      parts.forEach((txt, i)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.effect = effectsCycle[i % effectsCycle.length];
        const inner = document.createElement('div');
        inner.className = 'p';
        inner.textContent = txt;
        card.appendChild(inner);
        container.appendChild(card);
      });

      if(window.gsap && !prefersReducedMotion){
        if(window.ScrollTrigger) gsap.registerPlugin(ScrollTrigger);
        qsa('#blessingGrid .card').forEach((el)=>{
          const eff = el.dataset.effect;
          let vars={opacity:0,y:22,duration:.7,ease:'power2.out'};
          if(eff==='flip') vars={opacity:0,rotationY:90,transformOrigin:'50% 50%',duration:.7};
          if(eff==='type') vars={opacity:0,y:10,duration:.6};
          if(eff==='stamp') vars={opacity:0,scale:.9,duration:.6};
          if(eff==='sparkle') vars={opacity:0,y:18,duration:.7};
          if(eff==='mask') vars={opacity:0,y:10,duration:.6};
          if(eff==='cascade') vars={opacity:0,y:16,duration:.6};
          if(eff==='checklist') vars={opacity:0,y:18,duration:.6};
          if(eff==='finale') vars={opacity:0,y:30,duration:.8};
          if(['reveal','timeline','highlight'].includes(eff)) vars={opacity:0,y:16,duration:.6};
          gsap.from(el, { ...vars, scrollTrigger:{trigger:el, start:'top 80%', once:true, onEnter:()=>{ if(eff==='sparkle') heartConfetti(); }} });
        });
      }
    }

    /* ===== ×œ×•×— ×’×™×¨×•×“ 12 ===== */
    const SCRATCH_MAP_KEY='scratch_map_v2';
    const SCRATCH_OPEN_KEY='scratch_open_v2';
    const PRIZES=[
      {id:'p1',  title:'â˜˜ï¸ 5 ×’×¨× ×¡×œ×™×¤×¨×™', sub:'×¨×’×¢×™× ×™×¨×•×§×™× ×•××—×•×™×›×™×'},
      {id:'p2',  title:'ğŸ­ ×—×‘×™×œ×” ×¢× ×§×™×ª ×©×œ ×¡×•×›×¨×™×•×ª ×œ×•×œ×™×¤×•×¤', sub:''},
      {id:'p3',  title:'ğŸ¬ ×—×‘×™×œ×” ×¢× ×§×™×ª ×©×œ ×”×˜×•×¤×™ ×”××¨×•×š', sub:''},
      {id:'p4',  title:'ğŸ« ×”×•×¤×¢×” ×©×œ ××•×©×¨ ×›×”×Ÿ', sub:''},
      {id:'p5',  title:'ğŸ¸ ×”×•×¤×¢×” ×©×œ ××•× ×™×§×” ×¡×§×¡', sub:''},
      {id:'p6',  title:'ğŸ¤ ×™×¡××™×Ÿ ××•×¢×œ× â€” ×¤×¡×˜×™×‘×œ ×”×ª××¨', sub:'×”×–×¨×™×—×” ×”×¨××©×•× ×”'},
      {id:'p7',  title:'ğŸ¤ ×¢×•××¨ ××“×ğŸ˜ â€” ×¤×¡×˜×™×‘×œ ×”×ª××¨', sub:'×œ×—×œ×•× ×‘×§×•×œ'},
      {id:'p8',  title:'ğŸ¤ ××™×¤×” ×”×™×œ×“ â€” ×¤×¡×˜×™×‘×œ ×”×ª××¨', sub:'× ×•×¡×˜×œ×’×™×” ×‘×–×¨×™×—×”'},
      {id:'p9',  title:'ğŸ¶ ××•×© ×‘×Ÿ ××¨×™ & Co â€” ×¤×¡×˜×™×‘×œ ×”×ª××¨', sub:'×˜×•×‘ ×¢×œ ×”× ×©××”'},
      {id:'p10', title:'ğŸŒ ××ª×¨ ×™×•× ×”×•×œ×“×ª ×œ×ª××™×“', sub:'×”××–×›×¨×ª ×©×œ×š ×‘×¨×©×ª'},
      {id:'p11', title:'ğŸœ ×—×‘×™×œ×ª ×¨××× ×™×', sub:'×™×××™ ×™×××™'},
      {id:'p12', title:'ğŸ§´ ××œ×›×•×’\'×œ×™×', sub:'×›×™ ××ª ××›×•×¨×”'},
    ];
    function shuffle(a){const arr=a.slice();for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
    function loadMap(){try{const m=JSON.parse(localStorage.getItem(SCRATCH_MAP_KEY));if(Array.isArray(m)&&m.length===12)return m;}catch{} const map=shuffle(PRIZES.map(p=>p.id)); localStorage.setItem(SCRATCH_MAP_KEY,JSON.stringify(map)); return map;}
    function loadOpen(){try{const s=JSON.parse(localStorage.getItem(SCRATCH_OPEN_KEY)); return s&&typeof s==='object'? s : {};}catch{return {}}}
    function saveOpen(o){localStorage.setItem(SCRATCH_OPEN_KEY,JSON.stringify(o));}

    function setupScratch(){
      const grid=qs('#scratchGrid'); if(!grid) return;
      grid.innerHTML='';
      const map=loadMap(); const opened=loadOpen(); const byId=Object.fromEntries(PRIZES.map(p=>[p.id,p]));

      for(let i=0;i<12;i++){
        const pid=map[i], pr=byId[pid];
        const card=document.createElement('div'); card.className='scratch-card'; card.dataset.index=String(i);
        const content=document.createElement('div'); content.className='scratch-content';
        content.innerHTML=`<div class="title">${pr.title}</div>${pr.sub?`<div class="sub">${pr.sub}</div>`:''}`;
        const canvas=document.createElement('canvas'); canvas.className='scratch-canvas'; canvas.setAttribute('aria-label','×›×™×¡×•×™ ×’×™×¨×•×“'); canvas.setAttribute('role','img');
        const ctx=canvas.getContext('2d',{willReadFrequently:true});
        card.appendChild(content); card.appendChild(canvas); grid.appendChild(card);

        let w=0,h=0,dpr=1; let drawing=false; let strokes=0;
        const THRESH=0.55;
        const BR = matchMedia('(pointer:coarse)').matches ? 30 : 18;

        /* === ×˜×§×¡×˜ "×’×¨×“×™ ××•×ª×™" ×××•×¨×›×– ×‘×××¦×¢ === */
        function drawCenteredLabel(){
          const label = 'ğŸ ×’×¨×“×™ ××•×ª×™';
          const maxW = w * 0.86;    // ×œ×”×©××™×¨ ×©×•×œ×™×™×
          const maxH = h * 0.55;

          // ×‘×—×™×¨×ª ×’×•×“×œ ×¤×•× ×˜ ×©××ª××™× ×œ××¡×’×¨×ª
          let fs = Math.floor(Math.min(w,h) * 0.22);
          fs = Math.max(16, Math.min(28, fs));

          ctx.direction = 'ltr';           // ×¢×•×§×£ ×‘×¢×™×™×ª RTL ×‘×¡×¤××¨×™
          ctx.textAlign = 'center';          // × ×—×©×‘ ×™×“× ×™×ª ××ª ×”××¨×›×–
          ctx.textBaseline = 'alphabetic';
          ctx.fillStyle = '#ff2f75';

          // ×œ×”×§×˜×™×Ÿ ×¢×“ ×©× ×›× ×¡ ×œ×¨×•×—×‘/×’×•×‘×” ×”××•×ª×¨×™×
          while (fs > 12) {
            ctx.font = `900 16px Heebo, system-ui, sans-serif`;
            const m = ctx.measureText(label);
            const textW = m.width;
            const textH = (m.actualBoundingBoxAscent && m.actualBoundingBoxDescent)
              ? (m.actualBoundingBoxAscent + m.actualBoundingBoxDescent)
              : fs;
            if (textW <= maxW && textH <= maxH) break;
            fs--;
          }

          const m = ctx.measureText(label);
          const textW = m.width;
          const ascent = m.actualBoundingBoxAscent || fs*0.8;
          const descent = m.actualBoundingBoxDescent || fs*0.2;

          const x = Math.round((w - textW)/2);                    // ××¨×›×– ××•×¤×§×™
          const y = Math.round((h - (ascent + descent))/2 + ascent); // ××¨×›×– ×× ×›×™

          // ×§×• ××ª××¨ ×œ×‘×Ÿ ×œ×©×™×¤×•×¨ ×§×¨×™××•×ª
          ctx.lineJoin='round'; ctx.miterLimit=2;
          ctx.lineWidth = Math.max(2, Math.floor(fs * 0.16));
          ctx.strokeStyle = 'rgba(255,255,255,0.95)';
          ctx.strokeText(label, x, y);
          ctx.fillText(label, x, y);
        }

        function paintCover(){
          ctx.save();
          ctx.globalCompositeOperation='source-over';
          ctx.clearRect(0,0,w,h);
          ctx.fillStyle='#ffd5e5'; ctx.fillRect(0,0,w,h);
          ctx.strokeStyle='#ffc1d6'; ctx.lineWidth=2; ctx.strokeRect(1,1,w-2,h-2);
          drawCenteredLabel();
          ctx.restore();
          ctx.globalCompositeOperation='destination-out';
        }

        function resize(){
          const r=card.getBoundingClientRect();
          dpr=Math.max(1, window.devicePixelRatio || 1);
          w=Math.max(160, Math.floor(r.width));
          h=Math.max(128, Math.floor(r.height));
          canvas.width=Math.floor(w*dpr); canvas.height=Math.floor(h*dpr);
          canvas.style.width=w+'px'; canvas.style.height=h+'px';
          ctx.setTransform(dpr,0,0,dpr,0,0);   // ×—×“×•×ª ×‘-iOS
          paintCover();
          if(opened[i]) canvas.style.display='none';
        }

        function scratch(x,y){ ctx.beginPath(); ctx.arc(x,y,BR,0,Math.PI*2); ctx.fill(); if(++strokes%8===0) check(); }
        function check(){ try{
          const data=ctx.getImageData(0,0,Math.floor(w*dpr),Math.floor(h*dpr)).data;
          let transparent=0; for(let i=3;i<data.length;i+=4){ if(data[i]===0) transparent++; }
          const ratio= transparent / (w*h*dpr*dpr); if(ratio>THRESH) reveal();
        }catch{} }
        function reveal(){ card.classList.add('revealed'); canvas.style.display='none'; opened[i]=true; saveOpen(opened); heartConfetti(); }

        if(opened[i]){ card.classList.add('revealed'); canvas.style.display='none'; }

        const pos = (e)=>{ const rect=canvas.getBoundingClientRect(); const cx=(e.touches? e.touches[0].clientX : e.clientX) - rect.left; const cy=(e.touches? e.touches[0].clientY : e.clientY) - rect.top; return {x:cx, y:cy}; };
        canvas.addEventListener('pointerdown', e=>{ drawing=true; try{canvas.setPointerCapture(e.pointerId);}catch{} const p=pos(e); scratch(p.x,p.y); });
        canvas.addEventListener('pointermove', e=>{ if(!drawing) return; const p=pos(e); scratch(p.x,p.y); });
        ['pointerup','pointercancel','pointerleave'].forEach(ev=> canvas.addEventListener(ev, ()=> drawing=false));

        resize();
        // ×œ×¨× ×“×¨ ×©×•×‘ ××—×¨×™ ×©×”×¤×•× ×˜ × ×˜×¢×Ÿ
        if (document.fonts && document.fonts.ready) { document.fonts.ready.then(()=> paintCover()); }
        window.addEventListener('resize', resize);
      }

      qs('#resetScratch').addEventListener('click', ()=>{
        localStorage.removeItem(SCRATCH_MAP_KEY);
        localStorage.removeItem(SCRATCH_OPEN_KEY);
        setupScratch();
      });
    }

    /* ×× ×™×¢×ª ×’×¨×™×¨×ª ×ª××•× ×•×ª */
    qsa('img').forEach(img=>{
      img.addEventListener('dragstart', e=> e.preventDefault());
      img.addEventListener('contextmenu', e=> e.preventDefault());
    });

  })();
  </script>
</body>
</html>
